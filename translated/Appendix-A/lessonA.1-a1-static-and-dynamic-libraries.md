

A.1 — 静态库与动态库  
==================================  

[*Alex*](https://www.learncpp.com/author/Alex/ "查看 Alex 的所有文章")  
2007年6月28日下午6:36（PDT时间）  
2023年9月21日  

 

**库（library）**是可供多个程序复用的代码包。典型的C++库包含两个组成部分：  

1. 定义库功能接口的**头文件（header file）**（向使用库的程序公开可用功能）  
2. 包含预编译机器语言实现的**预编译二进制文件（precompiled binary）**  

某些库可能被拆分为多个文件，并/或包含多个头文件。  

库被预编译的主要原因如下：首先，由于库很少改动，无需频繁重新编译。每次编写使用库的程序时重新编译将浪费时间。其次，预编译的机器码可防止他人访问或修改源代码，这对出于知识产权考虑不愿公开源码的企业或个人至关重要。  

库分为两种类型：静态库和动态库。  

**静态库（static library）**（又称**归档文件（archive）**）包含直接编译链接到程序中的例程。当编译使用静态库的程序时，程序使用的所有静态库功能将成为可执行文件的一部分。在Windows系统中，静态库通常具有.lib扩展名；在Linux系统中则通常使用.a（archive）扩展名。静态库的优点是只需分发可执行文件即可运行程序。由于库已成为程序的一部分，这确保了程序始终使用正确版本的库。此外，静态库功能可像自编代码一样直接使用。缺点是每个使用库的可执行文件都包含库的副本，可能造成空间浪费。静态库也难以升级——更新库需要替换整个可执行文件。  

**动态库（dynamic library）**（亦称**共享库（shared library）**）包含程序运行时加载的例程。编译使用动态库的程序时，库不会成为可执行文件的一部分——它保持为独立单元。Windows系统中，动态库通常具有.dll（dynamic link library）扩展名；Linux系统中则使用.so（shared object）扩展名。动态库的优势在于多个程序可共享同一副本，节省空间。更大的优势是无需替换所有使用它的可执行文件即可升级动态库版本。  

由于动态库未链接到程序中，使用动态库的程序必须显式加载并与动态库交互。这种机制可能造成混淆，使得动态库使用较为复杂。为简化动态库使用，可借助**导入库（import library）**。  

**导入库**是自动加载和使用动态库的辅助库。在Windows系统中，通常通过与动态库（.dll）同名的静态库（.lib）实现。该静态库在编译时链接到程序中，之后即可像使用静态库那样调用动态库功能。在Linux系统中，共享对象（.so）文件同时作为动态库和导入库使用。大多数链接器在创建动态库时可生成对应的导入库。  

**安装与使用库**  

了解不同库类型后，让我们讨论如何在程序中实际使用库。C++库的安装通常包含4个步骤：  

1. **获取库**：最佳选择是下载对应操作系统的预编译包（若存在），避免自行编译。若无对应版本，需下载仅含源码的包并自行编译（此过程超出本课范围）。Windows系统中，库通常以.zip文件分发；Linux系统则多使用软件包格式（如.RPM）。包管理器可能已收录流行库（如SDL），建议优先检查。  
2. **安装库**：Linux系统中通常通过包管理器自动完成。Windows系统需将库解压到指定目录。建议将所有库集中存放（例如C:\\Libs目录），每个库存放在独立子目录。  
3. **配置编译器头文件搜索路径**：Windows系统中，通常是库安装目录的include子目录（例如库安装于C:\\libs\\SDL-1.2.11，则头文件可能在C:\\libs\\SDL-1.2.11\\include）。Linux系统通常将头文件安装到/usr/include（该路径默认已包含在编译器搜索路径中）。若文件安装于其他位置，需告知编译器其位置。  
4. **配置链接器库文件搜索路径**：与步骤3类似，需添加库文件所在目录。Windows系统中通常是库安装目录的/lib子目录。Linux系统通常安装到/usr/lib（默认已在库搜索路径中）。  

库安装完成且IDE知晓其位置后，每个使用该库的项目需执行以下3个步骤：  

5. **链接库文件**：若使用静态库或导入库，需告知链接器要链接的具体库文件。  
6. **包含头文件**：在程序中通过#include包含库头文件，使编译器知晓库提供的功能，确保正确编译。  
7. **配置动态库路径**：Linux系统中，动态库通常安装到/usr/lib（该路径在`LD_LIBRARY_PATH`环境变量之后默认搜索）。Windows系统的默认搜索路径包括：程序运行目录、SetDllDirectory()设置的目录、Windows/System/System32目录以及PATH环境变量中的目录。最简单的方式是将.dll复制到可执行文件所在目录。由于通常需与可执行文件一起分发.dll，保持二者同目录是合理选择。  

步骤3-5涉及IDE配置——几乎所有IDE的处理方式都相同。但由于不同IDE界面差异较大，最难的部分往往是找到执行这些步骤的正确位置。因此，本系列后续课程将分别讲解Visual Studio和Code::Blocks的具体配置方法。若使用其他IDE，建议阅读全部内容，届时您应能通过简单搜索完成自己IDE的配置。  

[下一课 A.2 在Visual Studio中使用库](https://www.learncpp.com/cpp-tutorial/a2-using-libraries-with-visual-studio-2005-express/)  
[返回目录](/)
[上一课 28.7 随机文件I/O](https://www.learncpp.com/cpp-tutorial/random-file-io/)