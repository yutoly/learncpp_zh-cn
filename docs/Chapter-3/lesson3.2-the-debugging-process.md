3.2 — 调试流程  
================================================

[*作者：Alex*](https://www.learncpp.com/author/Alex/ "查看 Alex 的所有文章")  
2019年2月1日 上午11:55（PST）  
2025年2月13日  

假设您编写了一个程序，但运行结果不正确——代码能正常编译，执行时却得到错误结果。这说明存在**语义错误（semantic error）**。如何定位错误？如果您遵循最佳实践（即编写少量代码后立即测试），可能对错误位置有大致判断。但有时也可能毫无头绪。  

所有错误都源于一个简单前提：您认为正确的部分实际上存在问题。准确找到错误源头往往充满挑战。本章将概述程序调试的通用流程。  

由于目前介绍的C++知识点有限，本章示例程序较为基础。这可能导致某些调试技巧显得小题大做。但请注意，这些技巧是为处理更复杂的大型程序而设计，在需要它们的场景中将发挥更大作用。  

调试的通用方法  
----------------  

发现问题后，调试流程通常包含六个步骤：  

1. **定位问题根源**（通常对应出错的代码行）。下一课将讨论具体定位策略  
2. 理解问题发生的原因  
3. 确定修复方案  
4. 修复问题  
5. 重新测试验证修复效果  
6. 重新测试确保未引发新问题  

我们通过生活实例来理解这个过程。假设某晚您使用冰箱的自动出冰口取冰：将杯子对准出口并按下把手后，没有任何冰块掉出。这个故障需要排查：  

**定位根源**：听到出冰装置运作声，说明机械部分正常。打开冷冻室检查冰盒，发现无冰块。这并非根本原因，而是另一表象。进一步检查发现制冰机未工作，而冷冻室温度正常、水管无堵塞，最终确定根源是制冰机故障。  

**理解问题**：制冰机损坏导致无法制冰。  

**确定修复方案**：可选方案包括购买袋装冰（临时方案）、修理零件、更换制冰机或购买新冰箱。您选择购买新制冰机。  

**修复问题**：安装新制冰机。  

**重新测试**：通电后次日，新制冰机正常产冰且未引发其他问题。  

现在将此流程应用于前课的示例程序：  

```cpp
#include <iostream>

int add(int x, int y) // 该函数本应执行加法操作
{
    return x - y; // 因错误使用运算符导致功能异常
}

int main()
{
    std::cout << "5 + 3 = " << add(5, 3) << '\n'; // 预期输出8，实际输出2

    return 0;
}
```  

该程序的优点在于错误明显：第10行输出了错误结果，这为排查提供了起点。  

**定位根源**：第10行使用字面量参数（5和3）调用`add`函数，参数无误。由于输入正确而输出错误，可判定`add`函数返回值异常。函数内唯一的返回语句即为问题所在。  

**理解问题**：显然错误源于使用减号而非加号。  

**确定修复方案**：将运算符`-`改为`+`。  

**修复问题**：修改运算符并重新编译。  

**重新测试**：修改后程序输出正确值8。对于简单程序，完成此测试即足够。  

此例虽简单，但展示了诊断任何程序时需经历的基础流程。  

[下一课 3.3 — 调试策略](Chapter-3/lesson3.3-a-strategy-for-debugging.md)  
[返回主页](/)  
[上一课 3.1 — 语法与语义错误](Chapter-3/lesson3.1-syntax-and-semantic-errors.md)