1.10 — 表达式简介  
===================================  

[*Alex*](https://www.learncpp.com/author/Alex/ "查看 Alex 的所有文章")  
2025年2月15日（首次发布于2007年6月6日）  

表达式解析  
----------------  

考虑以下系列变量定义与初始化的语句：  
```cpp
// five() 是返回5的函数
int five()
{
    return 5;
}

int main()
{
    int a{ 2 };             // 用字面值2初始化变量a
    int b{ 2 + 3 };         // 用计算值5初始化变量b
    int c{ (2 * 3) + 4 };   // 用计算值10初始化变量c
    int d{ b };             // 用变量值5初始化变量d
    int e{ five() };        // 用函数返回值5初始化变量e

    return 0;
}
```  

上述初始化器使用了多种不同实体：字面值、变量、运算符和函数调用。C++将这些不同要素转换为单个值用于变量初始化。这些初始化器的共同点是都使用了**表达式（expression）**。  

在编程中，**表达式**是由字面值、变量、运算符和函数调用组成的非空序列，用于计算某个值。执行表达式的过程称为**求值（evaluation）**，得到的值称为表达式的**结果（result）**（有时也称**返回值（return value）**）。  

> **进阶阅读**  
> C++表达式的结果可能是以下类型之一：  
> * 值（最常见）  
> * 对象或函数（详见课程[12.2 — 值类别（左值与右值）](Chapter-12/lesson12.2-value-categories-lvalues-and-rvalues.md)）  
> * 无结果（由无返回值函数调用产生，见课程[2.3 — void函数（无返回值函数）](Chapter-2/lesson2.3-void-functions-non-value-returning-functions.md)）  

目前为简化理解，我们假设表达式求值后均产生值。  

表达式求值时，内部各组成部分会被逐步计算，直至得到单个值。以下是不同类型表达式的示例（含注释说明求值过程）：  
```cpp
2               // 字面值2求值为2
"Hello world!"  // 字面值"Hello world!"求值为文本
x               // 变量x求值为其存储的值
2 + 3           // 运算符+使用操作数2和3求值为5
five()          // 求值为函数five()的返回值
```  

如示例所示，字面值求值为自身值，变量求值为其存储值，运算符（如`operator+`）使用操作数计算新值。函数调用在表达式上下文中求值为函数返回值。  

> **进阶阅读**  
> 涉及副作用（side effect）的运算符表达式更复杂：  
> ```cpp
> x = 5           // 副作用是将5赋给x，求值为x
> x = 2 + 3       // 副作用是将5赋给x，求值为x
> std::cout << x  // 副作用是打印x的值，求值为std::cout
> ```  

**核心洞察**  
在C++中，任何需要单个值的场合都可以使用产生值的表达式，该表达式将被求值为单个值。  

表达式不以分号结尾，无法独立编译。例如尝试编译`x = 5`会导致编译器报错（通常提示缺少分号）。表达式必须作为语句的组成部分进行求值。  

例如以下语句：  
```cpp
int x{ 2 + 3 }; // 2 + 3是不带分号的表达式，分号属于包含该表达式的语句
```  

该语句的语法结构为：`类型 标识符 { 表达式 };`  
*类型*可以是任意有效类型（此处选`int`），*标识符*是有效名称（此处为`x`），*表达式*是有效表达式（此处为`2 + 3`，使用两个字面值和一个运算符）。  

表达式语句  
----------------  

某些表达式（如`x = 5`）主要用于副作用（此处是将5赋给x）而非产生的值。  

> **相关内容**  
> 副作用详见课程[1.9 — 字面值与运算符简介](Chapter-1/lesson1.9-introduction-to-literals-and-operators.md)。  

由于表达式不能独立执行，必须转换为语句。**表达式语句（expression statement）**由表达式加分号构成。执行时，表达式将被求值。  

例如将`x = 5`转换为表达式语句`x = 5;`即可编译。表达式语句执行时会丢弃表达式的结果（因未被使用）。例如`x = 5`求值时，`operator=`的返回值被丢弃，但这不影响赋值操作。  

无意义表达式语句  
----------------  

可以创建能编译但无效的表达式语句。例如`(2 * 3);`求值得到6后即被丢弃。虽然语法有效，但此类语句无实际作用。GCC和Clang等编译器在检测到无用表达式语句时会发出警告。  

子表达式、完整表达式与复合表达式  
----------------  

考虑以下表达式：  
```cpp
2               // 字面值2求值为2
2 + 3           // 2 + 3使用运算符+求值为5
x = 4 + 5       // 4 + 5求值为9，然后赋给x
```  

* **子表达式（subexpression）**是作为操作数使用的表达式。例如`x = 4 + 5`的子表达式是`x`和`4 + 5`，而`4 + 5`的子表达式是`4`和`5`。  
* **完整表达式（full expression）**是非子表达式的表达式。上述三个表达式均为完整表达式。  
* **复合表达式（compound expression）**是包含两个及以上运算符的表达式。`x = 4 + 5`是复合表达式（使用`operator=`和`operator+`），而`2`和`2 + 3`不是。  

测验时间  
----------------  

**问题1**  
语句（statement）与表达式（expression）有何区别？  
  
<details><summary>答案</summary>语句用于程序执行动作，表达式用于计算值。</details>  

**问题2**  
判断以下代码行属于：  
a) 不含表达式的语句  
b) 含表达式的语句  
c) 表达式语句  

a)  
```cpp
int x;
```  
  
<details><summary>答案</summary>不含表达式的语句（变量定义语句，x在此处是定义而非求值）</details>  

b)  
```cpp
int x = 5;
```  
  
<details><summary>答案</summary>含表达式的语句（=右侧是表达式）</details>  

c)  
```cpp
x = 5;
```  
  
<details><summary>答案</summary>表达式语句</details>  

d) 附加题：  
```cpp
foo(); // foo是函数
```  
  
<details><summary>答案</summary>表达式语句（函数调用是表达式）</details>  

e) 附加题：  
```cpp
std::cout << x; // 提示：operator<<是二元运算符
```  
  
<details><summary>答案</summary>表达式语句（operator<<需要两个操作数）</details>  

**问题3**  
推断以下程序的输出（不编译，仅推演）：  
```cpp
#include <iostream>

int main()
{
	std::cout << 2 + 3 << '\n';
	
	int x{ 6 };
	int y{ x - 2 };
	std::cout << y << '\n';

	int z{};
	z = x;
	std::cout << z * x << '\n';

	return 0;
}
```  
  
<details><summary>答案</summary>  
5  
4  
36  
</details>  

[下一课 1.11 开发首个程序](Chapter-1/lesson1.11-developing-your-first-program.md)  
[返回主页](/)  
[上一课 1.9 字面值与运算符简介](Chapter-1/lesson1.9-introduction-to-literals-and-operators.md)