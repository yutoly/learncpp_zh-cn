21\.y — 第21章项目  
==========================

[*作者：Alex*](https://www.learncpp.com/author/Alex/ "查看 Alex 的所有文章")  
2024年9月13日（首次发布于2023年3月30日）

特别感谢读者Avtem构思并协作完成本项目。

项目时间  
----------------  

让我们实现经典游戏[15 Puzzle](https://en.wikipedia.org/wiki/15_puzzle)！

在15 Puzzle中，玩家初始会看到一个随机的4×4方块网格。15个方块标有数字1至15，一个方块缺失。例如：

```
     15   1   4
  2   5   9  12
  7   8  11  14
 10  13   6   3
```

缺失的方块位于左上角。

每个回合，玩家选择一个与缺失方块相邻的方块，将其滑动至空缺位置。游戏目标是将方块按数字顺序排列，缺失方块位于右下角：

```
  1   2   3   4
  5   6   7   8
  9  10  11  12
 13  14  15   
```

可通过[此网站](https://15puzzle.netlify.app/)试玩以理解游戏机制。

在我们的版本中，玩家每回合输入单字母指令：
* w - 上滑
* a - 左滑
* s - 下滑
* d - 右滑
* q - 退出

由于程序较长，我们将分阶段开发。

> 步骤说明  
> 每个步骤包含目标（goal）和任务（tasks）。目标定义阶段成果及相关信息，任务提供实现细节与提示。任务默认折叠，鼓励先尝试仅根据目标完成步骤，若遇困难可展开查看。

\> 步骤#1  
----------------  

目标：完成程序设计文档，规划程序高层结构。

A) 程序顶层需求：  
棋盘功能：
* 显示棋盘
* 显示单个方块
* 随机化初始状态
* 滑动方块
* 判断胜利条件

用户功能：
* 获取指令
* 处理无效输入
* 允许中途退出

B) 主要类/命名空间：
| 主类/命名空间/main | 实现功能 | 成员 |
| --- | --- | --- |
| class Board | 棋盘显示/随机化/滑动/胜利判断 | Tile二维数组 |
| class Tile | 显示单个方块 | 显示数字 |
| namespace UserInput | 获取/验证指令 | 无 |
| main() | 主循环/退出处理 | 无 |

C) 辅助类：
| 辅助类 | 功能 | 成员 |
| --- | --- | --- |
| class Point | 坐标索引 | x/y坐标 |
| class Direction | 方向处理 | 枚举方向 |

\> 步骤#2  
----------------  

目标：实现Tile类，显示单个方块。

代码要求：
* 默认构造函数
* 带数字参数的构造
* getNum()访问器
* isEmpty()判断空位
* 重载<<运算符

测试代码输出：
```
0123456789ABCDEF
 10   8       1 
false true
Tile 2 has number: 8
Tile 4 has number: 1
```

\> 步骤#3  
----------------  

目标：创建已解棋盘并显示。

实现Board类：
* 常量棋盘尺寸
* Tile二维数组（初始已解）
* 默认构造
* 重载<<运算符（打印前清空控制台）

输出效果：
```
  1   2   3   4
  5   6   7   8
  9  10  11  12
 13  14  15
```

\> 步骤#4  
----------------  

目标：实现指令输入与退出功能。

UserInput命名空间：
* getCommandFromUser()获取有效指令
* 处理无效输入

主程序：
* 无限循环获取指令
* 处理退出指令

测试输出：
```
w
Valid command: w
...
q
Bye!
```

\> 步骤#5  
----------------  

目标：实现Direction辅助类。

功能：
* 枚举方向类型
* 重载-运算符取反
* 静态随机方向生成
* UserInput::charToDirection转换

测试输出方向转换：
```
w → up
a → left
...
```

\> 步骤#6  
----------------  

目标：实现Point坐标类。

功能：
* x/y坐标存储
* 重载==/!=运算符
* getAdjacentPoint获取相邻坐标

测试用例：
```
Point{1,1}.getAdjacent(up) == {1,0} → true
...
```

\> 步骤#7  
----------------  

目标：实现方块滑动。

Board类新增：
* getEmptyTilePos获取空位
* isValidTilePos坐标验证
* swapTiles交换方块
* moveTile滑动处理

主程序：
* 处理方向指令后更新棋盘

\> 步骤#8  
----------------  

目标：随机化初始状态与胜利检测。

新增功能：
* Board::randomize随机打乱（有效解法）
* operator==棋盘比较
* playerWon胜利判断

最终程序：
* 初始随机化棋盘
* 循环检测胜利
* 胜利时输出"You won!"

[下一课 22.1 — 智能指针与移动语义简介](Chapter-22/lesson22.1-introduction-to-smart-pointers-move-semantics.md)  
[返回主页](/)  
[上一课 21.x — 第21章总结与测验](Chapter-21/lesson21.x-chapter-21-summary-and-quiz.md)