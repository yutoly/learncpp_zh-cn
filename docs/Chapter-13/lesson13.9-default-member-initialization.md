13.9 — 默认成员初始化  
=====================================  

[*作者：Alex*](https://www.learncpp.com/author/Alex/ "查看 Alex 的所有文章")  

2024年9月16日（首次发布于2022年1月18日）  

定义结构体（struct）或类（class）类型时，我们可为每个成员提供默认初始化值作为类型定义的一部分。对于非静态（non-static）成员，此过程有时称为**非静态成员初始化（non-static member initialization）**。这种初始化值称为**默认成员初始化器（default member initializer）**。  

> **相关内容**  
> 静态成员及静态成员初始化详见课程[15.6 — 静态成员变量](Chapter-15/lesson15.6-static-member-variables.md)。  

示例：  
```cpp
struct Something
{
    int x;       // 无初始化值（不良实践）
    int y {};    // 默认值初始化
    int z { 2 }; // 显式默认值
};

int main()
{
    Something s1; // s1.x未初始化，s1.y为0，s1.z为2
    return 0;
}
```  

上述`Something`定义中：`x`无默认值，`y`默认执行值初始化，`z`具有显式默认值`2`。当用户未提供显式初始值时，这些默认成员初始化值将被使用。  

`s1`对象没有初始化器，因此其成员使用默认值初始化。`s1.x`无默认初始化器，保持未初始化状态。`s1.y`默认值初始化为`0`，`s1.z`使用默认值`2`初始化。  

> **关键洞察**  
> 通过默认成员初始化器（或后续将介绍的其他机制），即使未提供显式初始化器，结构体和类也能完成自我初始化！  

> **进阶阅读**  
> CTAD（类模板参数推导，见课程[13.14 — 类模板参数推导与推导指南](Chapter-13/lesson13.14-class-template-argument-deduction-ctad-and-deduction-guides.md)）不能用于非静态成员初始化。  

显式初始化值优先于默认值  
----------------  

初始化列表中的显式值始终优先于默认成员初始化值：  
```cpp
Something s2 { 5, 6, 7 }; // s2.x、s2.y、s2.z分别初始化为5、6、7（不使用默认值）
```  

存在默认值时的缺失初始化器  
----------------  

若初始化列表元素少于成员数量：  
- 有默认值的成员使用默认初始化器  
- 无默认值的成员执行值初始化  

```cpp
Something s3 {}; // s3.x值初始化为0，s3.y和s3.z使用默认值
```  

初始化可能性总结  
----------------  

使用初始化列表定义聚合时：  
1. 存在显式值 → 使用显式值  
2. 初始化器缺失但存在默认值 → 使用默认值  
3. 初始化器缺失且无默认值 → 执行值初始化  

无初始化列表定义聚合时：  
1. 存在默认值 → 使用默认值  
2. 无默认值 → 成员保持未初始化  

成员始终按声明顺序初始化。  

以下示例总结所有情况：  
```cpp
Something s1;    // 无初始化列表：s1.x未初始化，s1.y/s1.z用默认值
Something s2{5,6,7}; // 显式初始化所有成员
Something s3{};  // 缺失初始化器：s3.x值初始化，s1.y/s1.z用默认值
```  

为避免未初始化成员，应为所有成员提供默认值：  
```cpp
struct Fraction
{
    int numerator { };   // 值初始化为0
    int denominator { 1 };
};
```  

> **最佳实践**  
> 为所有成员提供默认值，确保即使变量定义不含初始化列表也能正确初始化。  

默认初始化 vs 值初始化  
----------------  

对于聚合类型：  
```cpp
Fraction f1;   // 默认初始化：使用成员默认值
Fraction f2{}; // 值初始化：结果相同但更安全
```  

值初始化（空花括号）更安全，可防止成员遗漏默认值的情况。  

> **最佳实践**  
> 对于聚合类型，优先使用值初始化（空花括号）而非默认初始化（无花括号）。  

历史原因及特定情况下（非聚合类型），默认初始化可能比值初始化更高效（详见课程[14.11 — 默认构造函数与默认参数](Chapter-14/lesson14.11-default-constructors-and-default-arguments.md)）。  

[下一课 13.10 — 结构体的传递与返回](Chapter-13/lesson13.10-passing-and-returning-structs.md)  
[返回主页](/)  
[上一课 13.8 — 结构体的聚合初始化](Chapter-13/lesson13.8-struct-aggregate-initialization.md)