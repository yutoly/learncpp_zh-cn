2.13 — 如何设计首个程序  
=========================================

[*作者：Alex*](https://www.learncpp.com/author/Alex/ "查看 Alex 的所有文章")  
2009年9月5日 下午3:00（太平洋夏令时）  
2025年1月6日  

在掌握程序基础后，让我们深入探讨*如何*设计程序。  

当您着手编写程序时，通常已经有了某种创意构思。新程序员常面临如何将创意转化为实际代码的挑战。但事实上，您早已具备日常生活积累的解决问题能力。  

**关键原则**  
最重要（也最难）的是在编码前进行设计。编程如同建筑——未经设计的房屋终将问题重重（墙面歪斜、屋顶渗漏等）。同理，缺乏规划的程序必然漏洞百出，最终需要大量时间修复本可避免的问题。  

预先规划将为您节省时间并减少挫败感。本章将概述将创意转化为简单功能程序的通用方法。  

设计步骤1：明确目标  
----------------  

成功程序始于明确目标。理想情况下，可用一两句话描述用户可见的成果：  

* 允许用户管理姓名与对应电话号码列表  
* 生成具有视觉吸引力的随机洞穴地牢  
* 筛选高股息股票的推荐清单  
* 模拟塔顶坠球触地所需时间  

此步骤看似简单却至关重要，最糟糕的情况莫过于编写出不符合需求（自己或上级）的程序。  

设计步骤2：定义需求  
----------------  

需求包含解决方案的约束条件（预算、时间、内存等）和必须实现的功能。注意需求应聚焦"做什么"而非"如何做"：  

* 电话号码需持久化存储以便后续检索  
* 随机地牢必须包含入口到出口的可行路径  
* 股票推荐需利用历史价格数据  
* 用户可输入塔高  
* 七天内交付可测试版本  
* 用户提交请求后10秒内返回结果  
* 程序崩溃率低于0.1%  

单个问题可能产生多个需求，满足所有需求方为完整解决方案。  

设计步骤3：确定工具、目标与应急方案  
----------------  

资深程序员在此阶段通常还需考虑：  

* 目标架构/操作系统  
* 开发工具集  
* 团队协作方式  
* 测试/反馈/发布策略  
* 代码备份方案  

作为新程序员，这些问题的答案通常简单：使用自有系统、下载的IDE进行独立开发，代码仅供个人使用。  

**重要建议**  
处理非简单项目时，必须制定代码备份计划：  

* 避免仅在本机存储备份（设备故障将导致数据全失）  
* 移动存储（U盘）备份仍存在失窃/灾害风险  
* 最佳方案：异地备份  
	- 压缩后邮件发送  
	- 上传云存储（Dropbox）  
	- 使用FTP上传自有服务器  
	- 采用版本控制系统（如GitHub），支持版本回溯  

设计步骤4：分解复杂问题  
----------------  

处理复杂任务时，可采用**自顶向下（top-down）**方法：将任务拆分为更易处理的子任务，逐层分解直至各子任务均可管理。  

以清洁房屋为例：  
```
清洁房屋
├── 吸尘
├── 清洁浴室
│   ├── 刷洗马桶
│   └── 清理洗手池
└── 清洁厨房
    ├── 整理台面
    ├── 擦拭台面
    ├── 刷洗水槽
    └── 处理垃圾
```

**自底向上（bottom-up）**方法则通过组合相似任务构建层级。以通勤为例：  
```
前往工作地点
├── 卧室事务
│   ├── 关闭闹钟
│   ├── 起床
│   └── 挑选衣物
├── 卫浴事务
│   ├── 淋浴
│   ├── 更衣
│   └── 刷牙
├── 早餐事务
│   ├── 冲泡饮品
│   └── 食用麦片
└── 通勤事务
    ├── 骑自行车
    └── 前往公司
```

任务层级在编程中至关重要，顶层任务对应`main()`函数，子任务转为程序函数。若某函数实现困难，可继续分解为子函数，直至每个函数都易于实现。  

设计步骤5：确定执行顺序  
----------------  

建立程序结构后，需确定任务执行顺序。例如早晨流程：  
```
卧室事务 → 卫浴事务 → 早餐事务 → 通勤事务
```

计算器程序可能顺序：  
```
获取首个数字 → 获取运算符 → 获取次个数字 → 计算结果 → 输出结果
```

实现步骤1：构建main函数框架  
----------------  

根据执行顺序构建主函数框架，暂不处理输入输出：  
```cpp
int main()
{
    // doBedroomThings();
    // doBathroomThings();
    // doBreakfastThings();
    // doTransportationThings();
    return 0;
}
```

计算器示例：  
```cpp
int main()
{
    // 从用户处获取第一个数字
    // getUserInput();

    // 获取数学运算符
    // getMathematicalOperation();

    // 获取第二个数字
    // getUserInput();

    // 计算结果
    // calculateResult();

    // 输出结果
    // printResult();

    return 0;
}
```

**注意**：此时函数未定义，可注释调用或创建桩函数（空函数体）使程序通过编译。  

实现步骤2：逐个实现函数  
----------------  

每个函数实现需三步：  
1. 定义函数原型（输入输出）  
2. 编写函数体  
3. 测试函数  

若函数仍显复杂，需进一步分解。以计算器输入函数为例：  
```cpp
#include <iostream>

int getUserInput()
{
    std::cout << "输入整数：";
    int input{};
    std::cin >> input;
    return input;
}

int main()
{
    int value{ getUserInput() };
    std::cout << value << '\n'; // 测试代码，后续删除

    // 其余函数调用暂注释
    return 0;
}
```

完成函数后，通过多次测试验证其正确性。确认无误后移除测试代码，继续实现后续函数。  

**重要原则**  
* 分步实现，勿试图一次性完成整个程序  
* 相关测试方法详见课程[9.1 — 代码测试入门](Chapter-9/lesson9.1-introduction-to-testing-your-code.md)  

实现步骤3：最终测试  
----------------  

程序完成后进行全面测试，确保所有功能符合预期。发现问题及时修复。  

编程建议  
----------------  

**保持初始程序简单**  
宏伟愿景易使人受挫，例如："开发包含图形音效、随机地牢怪物、城镇交易系统的角色扮演游戏"。建议从可实现的小目标开始，如"显示二维场景"。  

**渐进式功能扩展**  
基础功能完善后逐步添加：显示场景 → 添加可移动角色 → 设置障碍墙 → 构建城镇 → 加入商人系统。  

**专注单一任务**  
优先完成一个完整功能，避免多任务并行导致半成品堆积。  

**分段测试代码**  
勿一次性编写完整程序。逐模块编写、编译、测试，及时定位问题。  

**避免过早优化**  
初版代码很少完美，过度优化（文档、最佳实践、性能调优）可能导致后续修改时前功尽弃。达到"可用"状态即可推进。  

**优先可维护性**  
Donald Knuth指出："过早优化是万恶之源"。应注重：  
* 消除冗余代码  
* 拆分长函数  
* 替换晦涩实现  
* 遵循最佳实践  
相关建议见课程[3.10 — 防患于未然](Chapter-3/lesson3.10-finding-issues-before-they-become-problems.md)  

> 任何可运行的复杂系统，必然是从可用的简单系统演化而来 —— John Gall，《系统学：系统如何运作与失败》第71页  

总结  
----------------  

新程序员常跳过设计步骤（因其看似繁琐且不如编码有趣），但对非简单项目而言，遵循这些步骤将节省大量时间。前期规划减少后期调试。  

**核心洞见**  
投入时间规划程序结构将提升代码质量并减少错误排查时间。  

> 这无疑是编程中最重要的事项，但像我这样的初学者常忽视其价值 —— 读者Emeka Daniel于learncpp.com评论  

随着对这些概念的熟练运用，您将逐渐能够快速编写完整函数与小程序。  

[下一课 2.x 第2章总结与测验](Chapter-2/lesson2.x-chapter-2-summary-and-quiz.md)  
[返回主页](/)  
[上一课 2.12 头文件保护](Chapter-2/lesson2.12-header-guards.md)