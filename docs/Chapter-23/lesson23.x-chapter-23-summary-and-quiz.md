23.x — 第23章总结与测验  
===================================  

[*作者：Alex*](https://www.learncpp.com/author/Alex/ "查看 Alex 的所有文章")  
2024年8月29日（首次发布于2016年9月12日 PDT下午9:28）  

本章提要  
----------------  

本章我们学习了对象间的多种关系类型。  

**核心总结**  

通过简单对象构建复杂对象的过程称为**对象组合（object composition）**。对象组合分为两种类型：组合（composition）与聚合（aggregation）。  

**组合（Composition）**存在于类成员与类之间存在部分属于（part-of）关系时。在组合关系中，类管理成员的存在周期。要构成**组合**，对象与其部分必须满足以下关系：  

* 部分（成员）属于对象（类）  
* 部分（成员）同一时间只能属于一个对象（类）  
* 部分（成员）的存在由对象（类）管理  
* 部分（成员）不知道对象（类）的存在  

组合通常通过普通成员变量实现，或通过指针实现（此时类负责所有内存分配与释放）。如果可以实现为组合，则应该优先选择组合。  

**聚合（Aggregation）**存在于类与成员之间存在拥有（has-a）关系时。在聚合关系中，类不管理成员的存在周期。要构成**聚合**，对象与其部分必须满足以下关系：  

* 部分（成员）属于对象（类）  
* 部分（成员）同一时间可以属于多个对象（类）  
* 部分（成员）的存在*不*由对象（类）管理  
* 部分（成员）不知道对象（类）的存在  

聚合通常通过指针或引用实现。  

**关联（Association）**是更松散的关系类型，类使用一个原本无关的对象。要构成**关联**，对象与关联对象必须满足以下关系：  

* 关联对象（成员）与对象（类）原本无关  
* 关联对象（成员）同一时间可以属于多个对象（类）  
* 关联对象（成员）的存在*不*由对象（类）管理  
* 关联对象（成员）可能知道或不知道对象（类）的存在  

关联可以通过指针、引用或更间接的方式实现（例如保存关联对象的索引或键）。  

在**依赖（Dependency）**关系中，一个类使用另一个类来完成任务。被依赖的类通常不作为使用方的成员，而是被临时创建、使用后销毁，或通过外部源传递给成员函数。  

**容器类（container class）**是指一个类作为容器来存储其他类型的多个对象。**值容器（value container）**是通过组合存储对象副本的容器。**引用容器（reference container）**是通过聚合存储外部对象指针或引用的容器。  

std::initializer_list（初始化列表）可用于实现接受列表初始化参数的构造函数、赋值运算符等函数。std::initializer_list位于\<initializer_list\>头文件。  

| 属性\\类型 | 组合（Composition） | 聚合（Aggregation） | 关联（Association） | 依赖（Dependency） |
| --- | --- | --- | --- | --- |
| 关系类型 | 整体/部分 | 整体/部分 | 原本无关 | 原本无关 |
| 成员可属于多个类 | 否 | 是 | 是 | 是 |
| 成员存在由类管理 | 是 | 否 | 否 | 否 |
| 方向性 | 单向 | 单向 | 单向或双向 | 单向 |
| 关系动词 | 部分属于（Part-of） | 拥有（Has-a） | 使用（Uses-a） | 依赖（Depends-on） |  

测验时间  
----------------  

本章内容较为抽象，测验将简明扼要。  

**问题1**  
以下描述分别对应哪种关系（组合、聚合、关联、依赖）？  

1a) 包含动物类型（枚举）和名称（字符串）的Animal类。  
  
<details><summary>答案</summary>组合 —— 动物类型和名称在Animal类外无独立用途。</details>  

1b) 具有save()函数的文本编辑器类，该函数接收File对象作为参数并将编辑器内容写入磁盘。  
  
<details><summary>答案</summary>依赖 —— 文本编辑器类使用File对象完成保存任务。</details>  

1c) 可携带剑、魔杖、药水等物品的冒险者类，这些物品可被其他冒险者拾取或丢弃。  
  
<details><summary>答案</summary>关联 —— 冒险者与物品非整体/部分关系，因此不是聚合。冒险者使用物品且不管理其存在。</details>  

1d) 玩家在圣坛祈祷以获得新能力。  
  
<details><summary>答案</summary>依赖 —— 玩家依赖圣坛获得能力，但无长期关联。</details>  

1e) 包含CPU类的计算机类，CPU可被拆卸单独测试。  
  
<details><summary>答案</summary>聚合 —— 计算机拥有CPU但不管理其存在。</details>  

1f) 铁匠使用特定铁砧工作。  
  
<details><summary>答案</summary>关联 —— 铁匠使用铁砧但无整体/部分关系。</details>  

**问题2**  
若可选择一种关系类型实现类，应优先选择（组合、聚合、关联、依赖）？  
  
<details><summary>答案</summary>组合</details>  

[下一课 24.1 — 继承简介](Chapter-24/lesson24.1-introduction-to-inheritance.md)
[返回主页](/)  
[上一课 23.7 — std::initializer_list](Chapter-23/lesson23.7-stdinitializer_list.md)